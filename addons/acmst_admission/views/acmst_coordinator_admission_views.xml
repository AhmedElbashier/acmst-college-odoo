<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Coordinator Admission Tree View -->
        <record id="view_acmst_coordinator_admission_tree" model="ir.ui.view">
            <field name="name">acmst.coordinator.admission.tree</field>
            <field name="model">acmst.admission.file</field>
            <field name="arch" type="xml">
                <tree string="Coordinator Review" decoration-success="state == 'coordinator_approved'" decoration-danger="state == 'coordinator_rejected'" decoration-warning="state == 'coordinator_review'" decoration-info="state == 'coordinator_conditional'" duplicate="False">
                    <field name="profile_picture" widget="image" options="{'size': [40, 40]}" string="Photo"/>
                    <field name="name" string="File #"/>
                    <field name="applicant_name_english" string="Applicant"/>
                    <field name="university_id" string="University ID" readonly="1"/>
                    <field name="is_processing_student" string="Processing" widget="boolean_toggle"/>
                    <field name="program_id" string="Program"/>
                    <field name="batch_id" string="Batch"/>
                    <field name="application_date" string="Submitted"/>
                    <field name="health_check_date" string="Health Check"/>
                    <field name="coordinator_id" string="Coordinator"/>
                    <field name="state" string="Status"/>
                </tree>
            </field>
        </record>

        <!-- Coordinator Admission Form View -->
        <record id="view_acmst_coordinator_admission_form" model="ir.ui.view">
            <field name="name">acmst.coordinator.admission.form</field>
            <field name="model">acmst.admission.file</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="Coordinator Review" duplicate="False">
                    <header>
                        <button name="action_coordinator_approve" string="Approve" type="object" class="btn-success" invisible="state != 'coordinator_review'"/>
                        <button name="action_coordinator_reject" string="Reject" type="object" class="btn-danger" invisible="state != 'coordinator_review'"/>
                        <button name="action_coordinator_conditional" string="Conditional Approval" type="object" class="btn-warning" invisible="state != 'coordinator_review' or admission_type not in ['transfer', 'bridging']"/>
                        <button name="action_create_conditions" string="Create Conditions" type="object" class="btn-info" invisible="state not in ['coordinator_review', 'coordinator_conditional'] or admission_type not in ['transfer', 'bridging']"/>
                        <button name="action_update_university_id" string="⚠️ Update University ID" type="object" class="btn-warning" invisible="state == 'cancelled'"/>
                        <field name="state" widget="statusbar" statusbar_visible="ministry_pending,ministry_approved,health_required,health_approved,coordinator_review,coordinator_approved,manager_review,manager_approved,completed"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <div class="row">
                                <div class="col-md-8">
                                    <h1>
                                        <field name="name" readonly="1"/>
                                    </h1>
                                    <div>
                                        <strong>Admission Type:</strong> <field name="admission_type" class="font-weight-bold"/>
                                    </div>
                                    <div>
                                        <strong>University ID:</strong> <field name="university_id" class="font-weight-bold" readonly="1" />
                                    </div>

                                    <h2>
                                        <field name="applicant_name_english" readonly="1"/>
                                    </h2>
                                </div>
                                <div class="col-md-4 text-right">
                                    <div class="oe_avatar">
                                        <field name="profile_picture" widget="image" class="oe_avatar_image" options="{'size': [100, 100]}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <group>
                            <group string="Application Details">
                                <field name="program_id" readonly="1"/>
                                <field name="batch_id" readonly="1"/>
                                <field name="application_date" readonly="1"/>
                                <field name="submission_method" readonly="1"/>
                            </group>
                            <group string="Review Status">
                                <field name="coordinator_id"/>
                                <field name="coordinator_approval_date"/>
                                <field name="health_check_date" readonly="1"/>
                                <field name="health_approver" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Personal Information">
                                <!-- Basic Personal Information -->
                                <group>
                                    <group string="Basic Information" col="2">
                                        <field name="applicant_name_english" readonly="1"/>
                                        <field name="applicant_name_arabic" readonly="1"/>
                                    </group>
                                    <group string="Birth Information" col="2">
                                        <field name="birth_date" readonly="1"/>
                                        <field name="place_of_birth" readonly="1"/>
                                        <field name="age" readonly="1"/>
                                    </group>
                                </group>

                                <!-- Identity and Personal Details -->
                                <group>
                                    <group string="Personal Details" col="2">
                                        <field name="gender" readonly="1"/>
                                        <field name="nationality" readonly="1"/>
                                        <field name="religion" readonly="1"/>
                                    </group>
                                    <group string="Identification" col="2">
                                        <field name="id_type" readonly="1"/>
                                        <field name="national_id" readonly="1"/>
                                        <field name="admission_type" readonly="1"/>
                                    </group>
                                </group>

                                <!-- Contact Information -->
                                <group>
                                    <group string="Contact Information" col="2">
                                        <field name="phone" readonly="1"/>
                                        <field name="email" readonly="1"/>
                                    </group>
                                    <group string="Address" col="2">
                                        <field name="address" readonly="1"/>
                                    </group>
                                </group>

                                <!-- Emergency Contact -->
                                <group>
                                    <group string="Emergency Contact" col="2">
                                        <field name="emergency_contact" readonly="1"/>
                                        <field name="emergency_phone" readonly="1"/>
                                    </group>
                                    <group></group>
                                </group>
                            </page>
                            <page string="Academic Information">
                                <!-- Educational Background -->
                                <group>
                                    <group string="Previous Education" col="6">
                                        <field name="previous_education" readonly="1" widget="text"/>
                                    </group>
                                </group>

                                <!-- Institution Information -->
                                <group>
                                    <group string="Institution Details" col="2">
                                        <field name="education_institution" readonly="1"/>
                                        <field name="education_program" readonly="1"/>
                                    </group>
                                    <group string="Education Details" col="2">
                                        <field name="education_college" readonly="1"/>
                                        <field name="education_major" readonly="1"/>
                                    </group>
                                </group>

                                <!-- Education Timeline -->
                                <group>
                                    <group string="Timeline" col="2">
                                        <field name="education_start_year" readonly="1"/>
                                        <field name="education_completion_year" readonly="1"/>
                                        <field name="certificate_type" readonly="1"/>
                                        <field name="education_duration_years" readonly="1"/>
                                    </group>
                                    <group string="Documents" col="6">
                                        <field name="certificates" readonly="1" filename="certificates_filename"/>
                                        <field name="transcripts" readonly="1" filename="transcripts_filename"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Health Check Results">
                                <div class="o_health_check_summary" style="margin-bottom: 20px;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                                <h4 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 5px;">
                                                    <i class="fa fa-heartbeat" style="color: #e74c3c; margin-right: 8px;" title="Health Check"></i>
                                                    Health Check Overview
                                                </h4>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <strong>Check Date:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="health_check_date" readonly="1" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <strong>Examiner:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="health_approver" readonly="1" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                                <h4 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #27ae60; padding-bottom: 5px;">
                                                    <i class="fa fa-check-circle" style="color: #27ae60; margin-right: 8px;" title="Medical Assessment"></i>
                                                    Medical Assessment
                                                </h4>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <strong>Fitness Status:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="health_fitness_status" readonly="1" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <strong>Follow-up Required:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="health_follow_up_required" readonly="1" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Health Check Details Table -->
                                <div class="o_health_check_details">
                                    <h3 style="color: #2c3e50; margin-bottom: 20px; border-left: 4px solid #3498db; padding-left: 15px;">
                                        <i class="fa fa-stethoscope" style="color: #3498db; margin-right: 8px;" title="Health Check Details"></i>
                                        Health Check Details
                                    </h3>
                                    <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                                        <field name="health_check_ids" readonly="1" nolabel="1" widget="one2many" options="{'create': False, 'edit': False, 'delete': False}"/>
                                    </div>
                                </div>
                            </page>
                            <page string="Coordinator Assessment">
                                <div class="o_coordinator_assessment_summary" style="margin-bottom: 20px;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                                <h4 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 5px;">
                                                    <i class="fa fa-user-check" style="color: #3498db; margin-right: 8px;" title="Review Decision"></i>
                                                    Review Decision
                                                </h4>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <strong>Coordinator:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="coordinator_id" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <strong>Approval Date:</strong><br/>
                                                        <span style="color: #7f8c8d; font-size: 14px;">
                                                            <field name="coordinator_approval_date" nolabel="1"/>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row" style="margin-top: 15px;">
                                                    <div class="col-md-12">
                                                        <strong>Notes:</strong><br/>
                                                        <field name="coordinator_notes" nolabel="1" placeholder="Enter coordinator assessment notes..."/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                                <h4 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #e67e22; padding-bottom: 5px;">
                                                    <i class="fa fa-tasks" style="color: #e67e22; margin-right: 8px;" title="Conditions Summary"></i>
                                                    Conditions Summary
                                                </h4>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="stat-item" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 10px;">
                                                            <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">
                                                                <field name="coordinator_conditions_ids" widget="statinfo" string="Total Conditions" options="{'count_field': 'id'}"/>
                                                            </div>
                                                            <div style="font-size: 12px; color: #7f8c8d;">Total Conditions</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="stat-item" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 10px;">
                                                            <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">
                                                                <field name="coordinator_conditions_ids" widget="statinfo" string="Overdue" options="{'count_field': 'id', 'domain': [('state', '=', 'overdue')]}"/>
                                                            </div>
                                                            <div style="font-size: 12px; color: #7f8c8d;">Overdue</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Conditions Management -->
                                <div class="o_conditions_management">
                                    <h3 style="color: #2c3e50; margin-bottom: 20px; border-left: 4px solid #e67e22; padding-left: 15px;">
                                        <i class="fa fa-list-check" style="color: #e67e22; margin-right: 8px;" title="Conditions Management"></i>
                                        Conditions Management
                                    </h3>
                                    
                                    <!-- Action Buttons -->
                                    <div class="o_conditions_actions" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <h5 style="color: #2c3e50; margin-bottom: 10px;">
                                                    <i class="fa fa-cogs" style="color: #e67e22; margin-right: 8px;" title="Condition Actions"></i>
                                                    Condition Actions
                                                </h5>
                                                <p style="color: #7f8c8d; margin-bottom: 0; font-size: 14px;">
                                                    Create new conditions or manage existing ones for this application.
                                                </p>
                                            </div>
                                            <div class="col-md-4" style="text-align: right;">
                                                <button name="action_create_conditions" string="Add Condition" type="object" class="btn btn-primary" style="margin-right: 10px;"/>
                                                <button name="action_view_conditions" string="Manage All" type="object" class="btn btn-info"/>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Conditions Table -->
                                    <div class="card" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                            <h4 style="color: #2c3e50; margin: 0; border-bottom: 2px solid #34495e; padding-bottom: 8px;">
                                                <i class="fa fa-table" style="color: #34495e; margin-right: 8px;" title="Current Conditions"></i>
                                                Current Conditions
                                            </h4>
                                            <div style="background: #e8f5e8; color: #2d5a2d; padding: 6px 12px; border-radius: 4px; font-size: 12px; border: 1px solid #c3e6c3;">
                                                <i class="fa fa-check-circle" style="margin-right: 4px;" title="Conditions Count"></i>
                                                <field name="coordinator_conditions_ids" widget="statinfo" string="conditions" options="{'count_field': 'id'}"/>
                                            </div>
                                        </div>
                                        
                                        <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; overflow: hidden;">
                                            <field name="coordinator_conditions_ids" readonly="1" nolabel="1" widget="one2many">
                                                <tree decoration-success="state == 'completed'" decoration-warning="state == 'pending'" decoration-danger="state == 'overdue'" decoration-info="state == 'rejected'">
                                                    <field name="subject_name" string="Subject" optional="show"/>
                                                    <field name="subject_code" string="Code" optional="hide"/>
                                                    <field name="level" string="Level" optional="show"/>
                                                    <field name="description" string="Description" optional="hide"/>
                                                    <field name="deadline" string="Deadline" optional="show"/>
                                                    <field name="days_remaining" string="Days Left" optional="show"/>
                                                    <field name="status" string="Status" optional="show"/>
                                                    <field name="state" string="State" optional="hide"/>
                                                    <field name="notes" string="Notes" optional="hide"/>
                                                </tree>
                                            </field>
                                        </div>
                                        
                                        <!-- Empty State -->
                                        <div class="o_view_nocontent" style="text-align: center; padding: 40px 20px; color: #6c757d; display: none;" id="no-conditions-message">
                                            <i class="fa fa-tasks" style="font-size: 48px; color: #dee2e6; margin-bottom: 16px;" title="No Conditions"></i>
                                            <h4 style="color: #6c757d; margin-bottom: 8px;">No Conditions Yet</h4>
                                            <p style="margin: 0; font-size: 14px;">Click "Add Condition" to create academic requirements for this application.</p>
                                        </div>
                                    </div>
                                </div>
                            </page>
                            <page string="Approval History">
                                <field name="approval_ids" readonly="1" nolabel="1"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                        <field name="activity_ids" widget="mail_activity"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Coordinator Admission Search View -->
        <record id="view_acmst_coordinator_admission_search" model="ir.ui.view">
            <field name="name">acmst.coordinator.admission.search</field>
            <field name="model">acmst.admission.file</field>
            <field name="arch" type="xml">
                <search string="Search Coordinator Reviews (Auto-assigned by Program)">
                    <field name="name" string="File #"/>
                    <field name="applicant_name_english" string="Applicant"/>
                    <field name="program_id" string="Program"/>
                    <field name="coordinator_id" string="Coordinator"/>
                    <field name="state" string="Status"/>
                    <separator/>
                    <filter string="Pending Review" name="coordinator_review" domain="[('state', '=', 'coordinator_review'), ('coordinator_id', '=', uid)]"/>
                    <filter string="Approved" name="coordinator_approved" domain="[('state', '=', 'coordinator_approved'), ('coordinator_id', '=', uid)]"/>
                    <filter string="Rejected" name="coordinator_rejected" domain="[('state', '=', 'coordinator_rejected'), ('coordinator_id', '=', uid)]"/>
                    <filter string="Conditional" name="coordinator_conditional" domain="[('state', '=', 'coordinator_conditional'), ('coordinator_id', '=', uid)]"/>
                    <separator/>
                    <filter string="My Reviews" name="my_reviews" domain="[('coordinator_id', '=', uid)]"/>
                    <filter string="Unassigned (No Program Coordinator)" name="unassigned" domain="[('coordinator_id', '=', False)]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Coordinator" name="group_coordinator" context="{'group_by': 'coordinator_id'}"/>
                        <filter string="Program" name="group_program" context="{'group_by': 'program_id'}"/>
                        <filter string="Application Date" name="group_date" context="{'group_by': 'application_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Coordinator Pending Review Action -->
        <record id="action_acmst_coordinator_pending_review" model="ir.actions.act_window">
            <field name="name">Pending Coordinator Review</field>
            <field name="res_model">acmst.admission.file</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', '=', 'coordinator_review'), ('coordinator_id', '=', uid)]</field>
            <field name="search_view_id" ref="view_acmst_coordinator_admission_search"/>
            <field name="context">{'create': False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No pending coordinator reviews
                </p>
                <p>
                    Applications requiring coordinator review assigned to you will appear here. Coordinators are automatically assigned based on the program.
                </p>
            </field>
        </record>

        <!-- Coordinator Approved Action -->
        <record id="action_acmst_coordinator_approved" model="ir.actions.act_window">
            <field name="name">Coordinator Approved</field>
            <field name="res_model">acmst.admission.file</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', '=', 'coordinator_approved'), ('coordinator_id', '=', uid)]</field>
            <field name="search_view_id" ref="view_acmst_coordinator_admission_search"/>
            <field name="context">{'create': False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No coordinator approved applications
                </p>
                <p>
                    Applications approved by you will appear here.
                </p>
            </field>
        </record>

        <!-- Coordinator Conditional Action -->
        <record id="action_acmst_coordinator_conditional" model="ir.actions.act_window">
            <field name="name">Conditional Approvals</field>
            <field name="res_model">acmst.admission.file</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', '=', 'coordinator_conditional'), ('coordinator_id', '=', uid)]</field>
            <field name="search_view_id" ref="view_acmst_coordinator_admission_search"/>
            <field name="context">{'create': False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No conditional approvals
                </p>
                <p>
                    Applications with conditional approvals by you will appear here.
                </p>
            </field>
        </record>

        <!-- Coordinator My Reviews Action -->
        <record id="action_acmst_coordinator_my_reviews" model="ir.actions.act_window">
            <field name="name">My Reviews</field>
            <field name="res_model">acmst.admission.file</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('coordinator_id', '=', uid), ('state', 'in', ['coordinator_review', 'coordinator_approved', 'coordinator_rejected', 'coordinator_conditional'])]</field>
            <field name="search_view_id" ref="view_acmst_coordinator_admission_search"/>
            <field name="context">{'create': False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No reviews assigned to you
                </p>
                <p>
                    Applications automatically assigned to you for review based on your program coordinator role will appear here.
                </p>
            </field>
        </record>

    </data>
</odoo>
